<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/public/images/MFav.png" type="image/png" />
    <title><%=title%></title>
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/2.0.3/css/dataTables.bootstrap5.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/public/style/theme.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      div.dt-container div.dt-length label {
        display: none !important;
      }
      div.dt-container div.dt-length select {
        width: 65px !important;
      }
    </style>
  </head>
  <body>
    <%- include("partials/header") %>
    <!-- main -->
    <main>
      <div class="container-fluid">
        <div class="row">
          <div class="col p-0 mb-4">
            <button id="toAddProduct" class="btn-primary btn m-3">
              <i class="fa-solid fa-plus"></i> Neues Produkt hinzuf√ºgen
            </button>
            <div class="card border-0 space_object">
              <div class="card-header bg-white py-3">
                <div class="title">Products list</div>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <% if(products) {%>
                  <table class="table" id="productTable">
                    <thead>
                      <tr>
                        <th>Img</th>
                        <th>Title</th>
                        <th>Categories</th>
                        <th class="mx150">Status</th>
                        <!-- <th class="mx150">Action</th> -->
                      </tr>
                    </thead>
                    <tbody id="categoriesTable">
                      <% products.forEach(function(product) { %>
                      <tr>
                        <td>
                          <img
                            src="https://hl-fc.de/uploads/<%-product.thumbnail%>"
                            alt=""
                            style="
                              width: 60px;
                              height: 60px;
                              object-fit: contain;
                            "
                          />
                        </td>
                        <td class="text-capitalize">
                          <% if (product.title && product.title.tr) { %> <%-
                          product.title.tr %><br />
                          <% } %> <% if (product.title && product.title.de) { %>
                          <%- product.title.de %><br />
                          <% } %> <% if (product.title && product.title.en) { %>
                          <%- product.title.en %><br />
                          <% } %>
                        </td>
                        <td class="text-capitalize">
                          <% product.categories.forEach(function(category) { %>
                          <%= category.categoryName %> <% }); %>
                        </td>
                        <td class="mx150">
                          <span
                            class="status <%- product.status %> text-capitalize"
                          >
                            <%- product.status %>
                          </span>
                        </td>
                        <!-- <td class="mx150">
                          <a href="/<%- product._id %>">
                            <i class="fa-regular fa-eye"></i>
                          </a>
                        </td> -->
                      </tr>
                      <% }); %>
                    </tbody>
                    <tfoot></tfoot>
                  </table>
                  <%} else { %>
                  <p>No products to show</p>
                  <% }%>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <!-- main end -->
    <div class="custom-toast d-none"></div>
    <!-- js -->
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.datatables.net/2.0.3/js/dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.3/js/dataTables.bootstrap5.min.js"></script>
    <script src="/public/config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="/public/js/theme.js"></script>
    <script>
      new DataTable("#productTable", {
        order: "ASC",
        columnDefs: [
          {
            width: 100,
            targets: 0, // Targets the first column
            type: "html", // Explicitly set the type to HTML to prevent automatic type detection
            className: "", // Resets or specifies classes to apply to cells in this column
            orderable: false, // Optional: disable ordering if it's not needed for the thumbnail column
            searchable: false, // Optional: disable searching on this column
          },
          { width: 250, targets: 1 },
          { width: 150, targets: 2 },
          { width: 150, targets: 3 },
          // { width: 100, targets: 4 },
        ],
      });
    </script>
    <script>
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(";");
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === name + "=") {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }

      // Retrieve the loginToken from cookies
      const loginToken = getCookie("loginToken");

      // Prepare the Axios request configuration, including the Authorization header
      const config = {
        headers: {
          Authorization: `Bearer ${loginToken}`,
        },
      };

      document.addEventListener("DOMContentLoaded", () => {
        const logoutButton = document.querySelector("#logoutButton");

        if (logoutButton) {
          logoutButton.addEventListener("click", () => {
            axios
              .post(`${API_URL}/logout`, {}, { withCredentials: true })
              .then((response) => {
                console.log("Logged out successfully");
                localStorage.removeItem("loginToken"); // Appropriate if you're using localStorage for additional token storage
                window.location.href = "/";
              })
              .catch((error) => {
                console.error("Error logging out:", error);
              });
          });
        }
      });
    </script>
  </body>
</html>
